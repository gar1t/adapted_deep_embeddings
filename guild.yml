- config: shared-flags
  flags:
    epochs: 10
    k:
      default: 10
      arg-name: examples-per-class
    n:
      default: 5
      arg-name: classes

- config: weight-transfer-base
  operations:
    train:
      main:
        _wt
          -d {{dataset}}
          -dp {{data-path}}
          --t1_train 8000
          --t1_valid 3000
          --t2_test 10000
          -bs 2048
          -lr 0.005
          -p 20
          -esr 0.01
          -r 1234
          --replications 1
          -g 0
          -ctl /cpu:0
          -sd .

      requires:
        - dataset
      flags:
        $include: shared-flags

- config: hist-loss-base
  operations:
    train:
      main:
        _hl
          -d {{dataset}}
          -dp {{data-path}}
          --t1_train 8000
          --t1_valid 3000
          --t2_test 10000
          -bs 1024
          -lr 0.005
          -p 20
          -esr 0.01
          -r 1234
          --replications 1
          -g 0
          -ctl /cpu:0
          -sd .

      requires:
        - dataset
      flags:
        $include: shared-flags

- config: mnist-support
  params:
    dataset: mnist
    data-path: mnist
  resources:
    dataset:
      path: mnist
      sources:
        - url: http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz
          sha256: 440fcabf73cc546fa21475e81ea370265605f56be210a4024d2ca8f203523609
        - url: http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz
          sha256: 3552534a0a558bbed6aed32b30c495cca23d567ec52cac8be1a0730e8010255c
        - url: http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz
          sha256: 8d422c7b0a1c1c79245a5bcf07fe86e33eeafee792b84584aec276f5a2dbc4e6
        - url: http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz
          sha256: f7ae60f92e00ec6debd23a6088c31dbd2371eca3ffa0defaefb259924204aec6

- model: weight-transfer-mnist
  extends:
    - weight-transfer-base
    - mnist-support

- model: hist-loss-mnist
  extends:
    - hist-loss-base
    - mnist-support
